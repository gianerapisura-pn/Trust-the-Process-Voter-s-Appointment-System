<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Appointment - Voter’s Appointment System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css" >
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<header class="header">
  <div class="logo-section">
    <img src="mylogo.png" alt="Logo" class="logo">
    <h1>TRUST THE PROCESS: VOTER’S APPOINTMENT SYSTEM</h1>
  </div>
</header>

<div class="text-center mt-3">
  <a href="appointment.html" class="nav-btn"><i class="fa-solid fa-calendar-days"></i> Schedule an Appointment</a>
  <a href="manage_appointment.html" class="nav-btn"><i class="fa-regular fa-clock"></i> Manage my Appointment</a>
  <a href="requirements.html" class="nav-btn"><i class="fa-solid fa-clipboard-list"></i> List of Requirements</a>
</div>

<div class="content-box">
  <p class="mb-4">
    To view, cancel, or download your filled application, please enter your Appointment Code and Email Address.
    Once complete, click the <strong>View Details</strong> button.
  </p>

  <form id="manageForm">
    <div class="row align-items-center mb-3">
      <div class="col-md-6">
        <label for="apptCode">Appointment Code</label>
        <input type="text" id="apptCode" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label for="email">Email Address</label>
        <input type="email" id="email" class="form-control" placeholder="EMAIL@DOMAIN.COM" required>
      </div>
    </div>

    <div class="text-center">
      <button type="submit" class="btn-action">View Details</button>
    </div>
  </form>

  <div id="appointmentsContainer" class="mt-4"></div>
</div>

<footer>
  <div class="footer-section">
    <div>
      <strong>TRUST THE PROCESS: VOTER’S APPOINTMENT SYSTEM</strong><br>
      123 Mabini Street, Barangay San Isidro, Quezon City, Metro Manila,<br>
      1103, Philippines
    </div>

    <div>
      <strong>CONTACT US</strong><br>
      vas.concerns@ttp.gov.ph<br>
      (02) 1234 - 5678
    </div>

    <div>
      <strong>SITEMAP</strong><br>
      <a href="index.html">HOME</a><br>
      <a href="#">REQUIREMENTS</a><br>
      <a href="appointment.html">SCHEDULE AN APPOINTMENT</a>
    </div>
  </div>
</footer>

<script src="api.js"></script>
<script src="appointment.js"></script>
<script src="manage.js"></script>

<script>
document.getElementById('manageForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const code = document.getElementById('apptCode').value.trim();
  const email = document.getElementById('email').value.trim();

  if (!code || !email) {
    alert('Please fill both fields.');
    return;
  }

  try {
    const appointments = await listAppointments({ appointment_code: code, email_address: email });
    const container = document.getElementById('appointmentsContainer');
    if (!appointments || appointments.length === 0) {
      container.innerHTML = '<p>No appointments found.</p>';
      return;
    }
    container.innerHTML = appointments.map(renderAppointmentRow).join('');
  } catch (err) {
    alert('Failed to fetch appointments.');
    console.error(err);
  }
});
</script>

</body>
</html>
